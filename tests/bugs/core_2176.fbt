{
'id': 'bugs.core_2176',
'qmid': None,
'tracker_id': 'CORE-2176',
'title': 'Unexpected (wrong) results with COALESCE and GROUP BY',
'description': '',
'min_versions': '',
'versions': [
{
 'firebird_version': '2.5.0',
 'platform': 'All',
 'page_size': '4096',
 'test_type': 'ISQL',
 'test_script': """set count on ;

select rdb$relation_id as c from rdb$relations
group by 1 ;
-- correct result

select * from (
select rdb$relation_id as c from rdb$relations
) group by 1 ;
-- also correct

select coalesce(rdb$relation_id, 0) as c from rdb$relations
group by 1 ;
-- ERROR: no zero ID is reported, the last ID is reported twice

select * from (
select coalesce(rdb$relation_id, 0) as c from rdb$relations
) group by 1 ;
-- ERROR: single NULL is returned

select * from (
  select coalesce(rdb$relation_id, 0) as a, coalesce(rdb$relation_type, 0) as b from rdb$relations
) group by 1, 2 ;
-- ERROR: infinite result set with all zero values

select * from (
  select coalesce(rdb$relation_id, 0) as a, coalesce(rdb$relation_name, '') as b from rdb$relations
) group by 1, 2 ;
-- ERROR: conversion error
""",
 'expected_stdout': """
      C
=======
      0
      1
      2
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
     13
     14
     15
     16
     17
     18
     19

      C
=======
     20
     21
     22
     23
     24
     25
     26
     27
     28
     29
     30
     31
     32
     33
     34
     35
     36
     37
     38
     39

      C
=======
     40
     41

Records affected: 42

      C
=======
      0
      1
      2
      3
      4
      5
      6
      7
      8
      9
     10
     11
     12
     13
     14
     15
     16
     17
     18
     19

      C
=======
     20
     21
     22
     23
     24
     25
     26
     27
     28
     29
     30
     31
     32
     33
     34
     35
     36
     37
     38
     39

      C
=======
     40
     41

Records affected: 42

           C
============
           0
           1
           2
           3
           4
           5
           6
           7
           8
           9
          10
          11
          12
          13
          14
          15
          16
          17
          18
          19

           C
============
          20
          21
          22
          23
          24
          25
          26
          27
          28
          29
          30
          31
          32
          33
          34
          35
          36
          37
          38
          39

           C
============
          40
          41

Records affected: 42

           C
============
           0
           1
           2
           3
           4
           5
           6
           7
           8
           9
          10
          11
          12
          13
          14
          15
          16
          17
          18
          19

           C
============
          20
          21
          22
          23
          24
          25
          26
          27
          28
          29
          30
          31
          32
          33
          34
          35
          36
          37
          38
          39

           C
============
          40
          41

Records affected: 42

           A            B
============ ============
           0            0
           1            0
           2            0
           3            0
           4            0
           5            0
           6            0
           7            0
           8            0
           9            0
          10            0
          11            0
          12            0
          13            0
          14            0
          15            0
          16            0
          17            0
          18            0
          19            0

           A            B
============ ============
          20            0
          21            0
          22            0
          23            0
          24            0
          25            0
          26            0
          27            0
          28            0
          29            0
          30            0
          31            0
          32            0
          33            3
          34            3
          35            3
          36            3
          37            3
          38            3
          39            3

           A            B
============ ============
          40            3
          41            3

Records affected: 42

           A B
============ ===============================================================================
           0 RDB$PAGES
           1 RDB$DATABASE
           2 RDB$FIELDS
           3 RDB$INDEX_SEGMENTS
           4 RDB$INDICES
           5 RDB$RELATION_FIELDS
           6 RDB$RELATIONS
           7 RDB$VIEW_RELATIONS
           8 RDB$FORMATS
           9 RDB$SECURITY_CLASSES
          10 RDB$FILES
          11 RDB$TYPES
          12 RDB$TRIGGERS
          13 RDB$DEPENDENCIES
          14 RDB$FUNCTIONS
          15 RDB$FUNCTION_ARGUMENTS
          16 RDB$FILTERS
          17 RDB$TRIGGER_MESSAGES
          18 RDB$USER_PRIVILEGES
          19 RDB$TRANSACTIONS

           A B
============ ===============================================================================
          20 RDB$GENERATORS
          21 RDB$FIELD_DIMENSIONS
          22 RDB$RELATION_CONSTRAINTS
          23 RDB$REF_CONSTRAINTS
          24 RDB$CHECK_CONSTRAINTS
          25 RDB$LOG_FILES
          26 RDB$PROCEDURES
          27 RDB$PROCEDURE_PARAMETERS
          28 RDB$CHARACTER_SETS
          29 RDB$COLLATIONS
          30 RDB$EXCEPTIONS
          31 RDB$ROLES
          32 RDB$BACKUP_HISTORY
          33 MON$DATABASE
          34 MON$ATTACHMENTS
          35 MON$TRANSACTIONS
          36 MON$STATEMENTS
          37 MON$CALL_STACK
          38 MON$IO_STATS
          39 MON$RECORD_STATS

           A B
============ ===============================================================================
          40 MON$CONTEXT_VARIABLES
          41 MON$MEMORY_USAGE

Records affected: 42
"""
}
]
}
