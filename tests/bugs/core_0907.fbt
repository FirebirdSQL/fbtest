{
'id': 'bugs.core_907',
'qmid': 'bugs.core_907-250',
'tracker_id': 'CORE-907',
'title': 'Server crash on violation of NOT NULL constraint',
'description': '',
'versions': [
{
 'firebird_version': '2.5.0',
 'platform': 'All',
 'init_script': """create table crash (A1 INTEGER,A2 INTEGER,A3 integer, A4 INTEGER) ;
commit;
INSERT INTO crash (A1,A2,A3,A4) VALUES (1,2,3,4);
INSERT INTO crash (A1,A2,A3) VALUES (2,3,4);
INSERT INTO crash (A1,A2,A4) VALUES (2,3,4);
commit;
ALTER TABLE CRASH ADD A5 COMPUTED BY (A2*A3*A4);
commit;

/* Now alter the NOT NULL flag for computed or any source column: */

update rdb$fields a
 set a.rdb$null_flag = 1
where
   a.rdb$field_name = (select b.rdb$field_source
   from rdb$relation_fields b where b.rdb$relation_name = 'CRASH' and b.rdb$field_name = 'A5');
commit;
""",
 'test_type': 'ISQL',
 'test_script': """update CRASH SET a1=2;
""",
 'expected_stderr': '''Statement failed, SQLSTATE = 23000
validation error for column *** unknown ***, value "*** null ***"'''
},
{
 'firebird_version': '2.0',
 'platform': 'All',
 'init_script': """create table crash (A1 INTEGER,A2 INTEGER,A3 integer, A4 INTEGER) ;
commit;
INSERT INTO crash (A1,A2,A3,A4) VALUES (1,2,3,4);
INSERT INTO crash (A1,A2,A3) VALUES (2,3,4);
INSERT INTO crash (A1,A2,A4) VALUES (2,3,4);
commit;
ALTER TABLE CRASH ADD A5 COMPUTED BY (A2*A3*A4);
commit;

/* Now alter the NOT NULL flag for computed or any source column: */

update rdb$fields a
 set a.rdb$null_flag = 1
where
   a.rdb$field_name = (select b.rdb$field_source
   from rdb$relation_fields b where b.rdb$relation_name = 'CRASH' and b.rdb$field_name = 'A5');
commit;
""",
 'test_type': 'ISQL',
 'test_script': """update CRASH SET a1=2;
""",
 'expected_stderr': '''Statement failed, SQLCODE = -625
validation error for column *** unknown ***, value "*** null ***"'''
}
]
}
